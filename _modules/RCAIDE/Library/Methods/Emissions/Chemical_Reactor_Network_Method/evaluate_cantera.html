
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera &#8212; RCAIDE</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/custom.css?v=d103512f" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/RCAIDE/Library/Methods/Emissions/Chemical_Reactor_Network_Method/evaluate_cantera';</script>
    <link rel="canonical" href="https://docs.rcaide.leadsresearchgroup.com/_modules/RCAIDE/Library/Methods/Emissions/Chemical_Reactor_Network_Method/evaluate_cantera.html" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../../_static/leads_logo.png" class="logo__image only-light" alt=""/>
    <img src="../../../../../../_static/leads_logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">RCAIDE</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../tutorials/tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../contributing.html">
    Contributing Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../api.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/leadsgroup/RCAIDE_LEADS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../tutorials/tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../contributing.html">
    Contributing Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../../../api.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/leadsgroup/RCAIDE_LEADS" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera</h1><div class="highlight"><pre>
<span></span><span class="c1"># RCAIDE/Library/Methods/Emissions/Chemical_Reactor_Network_Method/evaluate_cantera.py</span>

<span class="c1"># Created: June 2024, M. Clarke, M. Guidotti </span>
<span class="c1"># Updated: Mar 2025, M. Guidotti, J. Dost, D. Mehta</span>
<span class="c1"># Updates: Apr 2025, S. Shekar</span>

<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">#  IMPORT</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>

<span class="c1"># RCAIDE imports</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">RCAIDE.Framework.Core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Data</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w">                 </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">cantera</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ct</span>
    <span class="n">CANTERA_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">CANTERA_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1">#  evaluate_cantera</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------------------------   </span>
<div class="viewcode-block" id="evaluate_cantera">
<a class="viewcode-back" href="../../../../../../_autosummary/RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.html#RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.evaluate_cantera">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_cantera</span><span class="p">(</span><span class="n">combustor</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">mdot_air</span><span class="p">,</span><span class="n">FAR</span><span class="p">):</span> 

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluates emission indices using a Chemical Reactor Network (CRN) built in Cantera.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    combustor : Data</span>
<span class="sd">        Combustor configuration data</span>
<span class="sd">        - diameter : float</span>
<span class="sd">            Combustor diameter [m]</span>
<span class="sd">        - length : float</span>
<span class="sd">            Combustor length [m]</span>
<span class="sd">        - number_of_combustors : int</span>
<span class="sd">            Number of combustors for one engine [-]</span>
<span class="sd">        - F_SC : float</span>
<span class="sd">            Fuel scale factor [-]</span>
<span class="sd">        - N_PZ : int</span>
<span class="sd">            Number of PSR in the Primary Zone [-]</span>
<span class="sd">        - L_PZ : float</span>
<span class="sd">            Primary Zone length [m]</span>
<span class="sd">        - S_PZ : float</span>
<span class="sd">            Mixing parameter in the Primary Zone [-]</span>
<span class="sd">        - design_equivalence_ratio_PZ : float</span>
<span class="sd">            Design Equivalence Ratio in Primary Zone at Maximum Throttle [-]</span>
<span class="sd">        - N_SZ : int</span>
<span class="sd">            Number of discretizations in the Secondary Zone [-]</span>
<span class="sd">        - f_SM : float</span>
<span class="sd">            Slow mode fraction [-]</span>
<span class="sd">        - l_SA_SM : float</span>
<span class="sd">            Secondary air length fraction (of L_SZ) in slow mode [-]</span>
<span class="sd">        - l_SA_FM : float</span>
<span class="sd">            Secondary air length fraction (of L_SZ) in fast mode [-]</span>
<span class="sd">        - l_DA_start : float</span>
<span class="sd">            Dilution air start length fraction (of L_SZ) [-]</span>
<span class="sd">        - l_DA_end : float</span>
<span class="sd">            Dilution air end length fraction (of L_SZ) [-]</span>
<span class="sd">        - joint_mixing_fraction : float</span>
<span class="sd">            Joint mixing fraction [-]</span>
<span class="sd">        - design_equivalence_ratio_SZ : float</span>
<span class="sd">            Design Equivalence Ratio in Secondary Zone [-]</span>
<span class="sd">        - air_mass_flow_rate_take_off : float</span>
<span class="sd">            Air mass flow rate at take-off [kg/s]</span>
<span class="sd">        - fuel_to_air_ratio_take_off : float</span>
<span class="sd">            Fuel to air ratio at take-off [-]</span>
<span class="sd">        - air_data : Data</span>
<span class="sd">            Air object containing air surrogate species</span>
<span class="sd">        - fuel_data : Data</span>
<span class="sd">            Fuel object containing fuel properties and kinetics</span>
<span class="sd">    </span>
<span class="sd">    T : float</span>
<span class="sd">        Stagnation Temperature entering combustors [K]</span>
<span class="sd">    P : float</span>
<span class="sd">        Stagnation Pressure entering combustors [Pa]</span>
<span class="sd">    mdot_air : float</span>
<span class="sd">        Air mass flow entering the combustor [kg/s]</span>
<span class="sd">    FAR : float</span>
<span class="sd">        Fuel-to-Air ratio [-]</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : Data</span>
<span class="sd">        Container for emission indices</span>
<span class="sd">        - EI_CO2 : float</span>
<span class="sd">            CO2 emission index [kg_CO2/kg_fuel]</span>
<span class="sd">        - EI_CO : float</span>
<span class="sd">            CO emission index [kg_CO/kg_fuel]</span>
<span class="sd">        - EI_H2O : float</span>
<span class="sd">            H2O emission index [kg_H2O/kg_fuel]</span>
<span class="sd">        - EI_NOx : float</span>
<span class="sd">            NOx emission index [kg_NOx/kg_fuel]</span>
<span class="sd">        - final_phi : float</span>
<span class="sd">            Final equivalence ratio [-]</span>
<span class="sd">        - final_T : float</span>
<span class="sd">            Final temperature [K]</span>
<span class="sd">        - PZ_phi : list</span>
<span class="sd">            Equivalence ratio in the Primary Zone [-]</span>
<span class="sd">        - PZ_T : list</span>
<span class="sd">            Temperature in the Primary Zone [K]</span>
<span class="sd">        - PZ_f_psr : list</span>
<span class="sd">            Fraction of mass flow entering each PSR [-]</span>
<span class="sd">        - PZ_EI_CO2 : list</span>
<span class="sd">            CO2 emission index in the Primary Zone [kg_CO2/kg_fuel]</span>
<span class="sd">        - PZ_EI_CO : list</span>
<span class="sd">            CO emission index in the Primary Zone [kg_CO/kg_fuel]</span>
<span class="sd">        - PZ_EI_H2O : list</span>
<span class="sd">            H2O emission index in the Primary Zone [kg_H2O/kg_fuel]</span>
<span class="sd">        - PZ_EI_NOx : list</span>
<span class="sd">            NOx emission index in the Primary Zone [kg_NOx/kg_fuel]</span>
<span class="sd">        - SZ_sm_z : list</span>
<span class="sd">            Positions in the Secondary Zone slow mode [-]</span>
<span class="sd">        - SZ_sm_phi : list</span>
<span class="sd">            Equivalence ratio in the Secondary Zone slow mode [-]</span>
<span class="sd">        - SZ_sm_T : list</span>
<span class="sd">            Temperature in the Secondary Zone slow mode [K]</span>
<span class="sd">        - SZ_sm_EI_CO2 : list</span>
<span class="sd">            CO2 emission index in the Secondary Zone slow mode [kg_CO2/kg_fuel]</span>
<span class="sd">        - SZ_sm_EI_CO : list</span>
<span class="sd">            CO emission index in the Secondary Zone slow mode [kg_CO/kg_fuel]</span>
<span class="sd">        - SZ_sm_EI_H2O : list</span>
<span class="sd">            H2O emission index in the Secondary Zone slow mode [kg_H2O/kg_fuel]</span>
<span class="sd">        - SZ_sm_EI_NOx : list</span>
<span class="sd">            NOx emission index in the Secondary Zone slow mode [kg_NOx/kg_fuel]</span>
<span class="sd">        - SZ_fm_z : list</span>
<span class="sd">            Positions in the Secondary Zone fast mode [-]</span>
<span class="sd">        - SZ_fm_phi : list</span>
<span class="sd">            Equivalence ratio in the Secondary Zone fast mode [-]</span>
<span class="sd">        - SZ_fm_T : list</span>
<span class="sd">            Temperature in the Secondary Zone fast mode [K]</span>
<span class="sd">        - SZ_fm_EI_CO2 : list</span>
<span class="sd">            CO2 emission index in the Secondary Zone fast mode [kg_CO2/kg_fuel]</span>
<span class="sd">        - SZ_fm_EI_CO : list</span>
<span class="sd">            CO emission index in the Secondary Zone fast mode [kg_CO/kg_fuel]</span>
<span class="sd">        - SZ_fm_EI_H2O : list</span>
<span class="sd">            H2O emission index in the Secondary Zone fast mode [kg_H2O/kg_fuel]</span>
<span class="sd">        - SZ_fm_EI_NOx : list</span>
<span class="sd">            NOx emission index in the Secondary Zone fast mode [kg_NOx/kg_fuel]</span>
<span class="sd">        - SZ_joint_z : list</span>
<span class="sd">            Positions in the Secondary Zone joint mode [-]</span>
<span class="sd">        - SZ_joint_phi : list</span>
<span class="sd">            Equivalence ratio in the Secondary Zone joint mode [-]</span>
<span class="sd">        - SZ_joint_T : list</span>
<span class="sd">            Temperature in the Secondary Zone joint mode [K]</span>
<span class="sd">        - SZ_joint_EI_CO2 : list</span>
<span class="sd">            CO2 emission index in the Secondary Zone joint mode [kg_CO2/kg_fuel]</span>
<span class="sd">        - SZ_joint_EI_CO : list</span>
<span class="sd">            CO emission index in the Secondary Zone joint mode [kg_CO/kg_fuel]</span>
<span class="sd">        - SZ_joint_EI_H2O : list</span>
<span class="sd">            H2O emission index in the Secondary Zone joint mode [kg_H2O/kg_fuel]</span>
<span class="sd">        - SZ_joint_EI_NOx : list</span>
<span class="sd">            NOx emission index in the Secondary Zone joint mode [kg_NOx/kg_fuel]</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function uses Cantera to simulate the chemical kinetics and thermodynamics of the combustor. It requires the Cantera module to be installed.</span>
<span class="sd">    </span>
<span class="sd">    **Extra modules required**</span>
<span class="sd">    </span>
<span class="sd">    * Cantera</span>
<span class="sd">    </span>
<span class="sd">    **Major Assumptions**</span>
<span class="sd">        * The combustor operates under steady-state conditions.</span>
<span class="sd">        * The fuel and air are perfectly mixed before entering the combustor.</span>
<span class="sd">    </span>
<span class="sd">    **Theory**</span>
<span class="sd">    </span>
<span class="sd">    The function evaluates the emission indices by simulating the chemical reactions in the combustor using Cantera. The emissions are calculated based on the chemical kinetics and thermodynamics of the fuel and air mixture.</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    [1] Goodwin, D. G., Speth, R. L., Moffat, H. K., &amp; Weber, B. W. (2023). Cantera: An object-oriented software toolkit for chemical kinetics, thermodynamics, and transport processes (Version 3.0.0) [Computer software]. https://www.cantera.org</span>
<span class="sd">    [2] Brink, L. F. J. (2020). Modeling the impact of fuel composition on aircraft engine NOâ‚“, CO, and soot emissions. Master&#39;s thesis, Massachusetts Institute of Technology.</span>
<span class="sd">    [3] Allaire, D. L. (2006). A physics-based emissions model for aircraft gas turbine combustors. Master&#39;s thesis, Massachusetts Institute of Technology.</span>
<span class="sd">    [4] Lefebvre, A. H., &amp; Ballal, D. R. (2010). Gas turbine combustion: Alternative fuels and emissions (3rd ed.). CRC Press.</span>
<span class="sd">    </span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_CRN_emission_indices_no_surrogate</span>
<span class="sd">    RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_CRN_emission_indices_surrogate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># ------------------------------------------------------------------------------              </span>
    <span class="c1"># ------------------------------ Combustor Inputs ------------------------------              </span>
    <span class="c1"># ------------------------------------------------------------------------------              </span>

    <span class="n">rcaide_root</span>    <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
    <span class="n">mechanism_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rcaide_root</span><span class="p">,</span> <span class="s1">&#39;Emissions&#39;</span><span class="p">,</span> <span class="s1">&#39;Chemical_Reactor_Network_Method&#39;</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">)</span>
    <span class="n">gas</span>            <span class="o">=</span> <span class="n">mechanism_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">kinetic_mechanism</span>

    <span class="n">data</span>                  <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>         
    <span class="n">data</span><span class="o">.</span><span class="n">final</span>            <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span>         <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>     <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel]                             </span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>      <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel]                               </span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>     <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel]                               </span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>     <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel]  </span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">phi</span>        <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">T</span>          <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span>               <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span>           <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">phi</span>       <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">T</span>         <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">f_psr</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span>        <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">phi</span>           <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">T</span>             <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">f_psr</span>         <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span>            <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>        <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>         <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>        <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>        <span class="o">=</span> <span class="mi">0</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span>               <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span>            <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">z</span>          <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">phi</span>        <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">T</span>          <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span>         <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>      <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span>            <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">z</span>          <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">phi</span>        <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span>          <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span>         <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>      <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span>         <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">z</span>       <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">phi</span>     <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [-] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">T</span>       <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [K] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span>      <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span>   <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel] </span>
    <span class="n">data</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [kg/kg_fuel]  </span>

    
    <span class="n">compute_combustor_performance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">combustor</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">mdot_air</span><span class="p">,</span> <span class="n">FAR</span><span class="p">,</span> <span class="n">gas</span><span class="p">)</span> <span class="c1"># [-] Run combustor function                                                           </span>
     
    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1">#  RQL Burner Model</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="compute_combustor_performance">
<a class="viewcode-back" href="../../../../../../_autosummary/RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.html#RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.compute_combustor_performance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_combustor_performance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">combustor</span><span class="p">,</span> <span class="n">Temp_air</span><span class="p">,</span> <span class="n">Pres_air</span><span class="p">,</span> <span class="n">mdot_air_tot</span><span class="p">,</span> <span class="n">FAR</span><span class="p">,</span> <span class="n">gas</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">CANTERA_AVAILABLE</span><span class="p">:</span>
        <span class="n">mdot_fuel_TakeOff</span> <span class="o">=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_to_air_ratio_take_off</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">air_mass_flow_rate_take_off</span> <span class="c1"># [kg/s] Fuel mass flow rate at Take Off</span>
        <span class="n">mdot_fuel_tot</span>     <span class="o">=</span> <span class="n">mdot_air_tot</span> <span class="o">*</span> <span class="n">FAR</span>                             <span class="c1"># [kg/s] Fuel mass flow rate </span>
        <span class="n">mdot_air</span>          <span class="o">=</span> <span class="n">mdot_air_tot</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">number_of_combustors</span>  <span class="c1"># [kg/s] Air mass flow rate per combustor</span>
        <span class="n">mdot_fuel</span>         <span class="o">=</span> <span class="n">mdot_fuel_tot</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">number_of_combustors</span> <span class="c1"># [kg/s] Fuel mass flow rate per combustor</span>

        <span class="n">f_air_PZ</span>          <span class="o">=</span> <span class="n">mdot_fuel_TakeOff</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">F_SC</span> <span class="o">/</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">design_equivalence_ratio_PZ</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">air_mass_flow_rate_take_off</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">stoichiometric_fuel_air_ratio</span><span class="p">)</span> <span class="c1"># [-] Air mass flow rate fraction in Primary Zone</span>
        <span class="n">phi_sign</span>          <span class="o">=</span> <span class="p">(</span><span class="n">mdot_fuel</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">F_SC</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mdot_air</span> <span class="o">*</span> <span class="n">f_air_PZ</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">stoichiometric_fuel_air_ratio</span><span class="p">)</span> <span class="c1"># [-] Mean equivalence ratio in the Primary Zone</span>
        <span class="n">sigma_phi</span>         <span class="o">=</span> <span class="n">phi_sign</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">S_PZ</span>                      <span class="c1"># [-] Standard deviation of the Equivalence Ratio in the Primary Zone</span>
        <span class="n">V_PZ</span>              <span class="o">=</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">volume</span><span class="o">/</span><span class="n">combustor</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_PZ</span> <span class="c1"># [m^3] Volume of the Primary Zone</span>
        <span class="n">V_PZ_PSR</span>          <span class="o">=</span> <span class="n">V_PZ</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_PZ</span>                          <span class="c1"># [m^3] Volume of each PSR</span>
        <span class="n">mdot_air_PZ</span>       <span class="o">=</span> <span class="n">f_air_PZ</span> <span class="o">*</span> <span class="n">mdot_air</span>                            <span class="c1"># [kg/s] Air mass flow rate in the Primary Zone</span>
        <span class="n">phi_PSR</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">phi_sign</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_phi</span><span class="p">,</span> <span class="n">phi_sign</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_phi</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_PZ</span><span class="p">)</span> <span class="c1"># [-] Equivalence ratio in each PSR </span>
        <span class="n">Delta_phi</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi_PSR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi_PSR</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>                <span class="c1"># [-] Equivalence ratio step in the Primary Zone</span>

        <span class="n">fuel</span>              <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>                               <span class="c1"># [-] Fuel object</span>
        <span class="n">fuel</span><span class="o">.</span><span class="n">TPX</span>          <span class="o">=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">fuel_surrogate_S1</span>                   <span class="c1"># [K, Pa, -] Temperauture, Pressure and Mole fraction composition of fuel</span>
        <span class="n">fuel_reservoir</span>    <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Reservoir</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>                             <span class="c1"># [-] Fuel reservoir</span>
        <span class="n">air</span>               <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>                               <span class="c1"># [-] Air object</span>
        <span class="n">air</span><span class="o">.</span><span class="n">TPX</span>           <span class="o">=</span> <span class="n">Temp_air</span><span class="p">,</span> <span class="n">Pres_air</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">air_data</span><span class="o">.</span><span class="n">air_surrogate</span>                      <span class="c1"># [K, Pa, -] Temperauture, Pressure and Mole fraction composition of air</span>
        <span class="n">air_reservoir</span>     <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Reservoir</span><span class="p">(</span><span class="n">air</span><span class="p">)</span>                              <span class="c1"># [-] Air reservoir</span>
        <span class="n">fuel_hot</span>          <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>                               <span class="c1"># [-] Fuel hot state</span>
        <span class="n">fuel_hot</span><span class="o">.</span><span class="n">TPX</span>      <span class="o">=</span> <span class="n">Temp_air</span><span class="p">,</span> <span class="n">Pres_air</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">fuel_surrogate_S1</span>                     <span class="c1"># [K, Pa, -] Temperauture, Pressure and Mole fraction composition of hot fuel</span>
        <span class="n">delta_h</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fuel</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="n">fuel_hot</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>                    <span class="c1"># [J/kg] Fuel specific enthalpy difference</span>

        <span class="n">PZ_Structures</span>     <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PSRs&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;MFC_AirToPSR&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;MFC_FuelToPSR&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;PSR_Networks&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;MFC_PSRToMixer&quot;</span><span class="p">:</span> <span class="p">{}}</span> <span class="c1"># [-] Primary Zone structures</span>
        <span class="n">mdot_PZ</span><span class="p">,</span> <span class="n">f_PSR_data</span><span class="p">,</span> <span class="n">mass_psr_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># [-] Arrays to store results</span>
        <span class="n">mixer</span>             <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">air</span><span class="p">)</span>                   <span class="c1"># [-] Mixer object</span>

        <span class="n">phi_diff</span>          <span class="o">=</span> <span class="n">phi_PSR</span> <span class="o">-</span> <span class="n">phi_sign</span>                             <span class="c1"># [-] Equivalence ratio difference</span>
        <span class="n">f_PSR_data</span>        <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_phi</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">phi_diff</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_phi</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">Delta_phi</span> <span class="c1"># [-] Fraction of mass flow entering each reactor</span>
        <span class="n">f_PSR_data</span>       <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">f_PSR_data</span><span class="p">)</span>                             <span class="c1"># [-] Normalizes mass flow rate fraction in each PSR</span>
        
        <span class="c1"># ------------------------------------------------------------------</span>
        <span class="c1">#  Primary Zone (PZ)</span>
        <span class="c1"># ------------------------------------------------------------------</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">N_PZ</span><span class="p">):</span>

            <span class="n">f_PSR_PZ_i</span>      <span class="o">=</span> <span class="n">f_PSR_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                                <span class="c1"># [-] Fuel mass flow rate fraction in the PSR</span>
            <span class="n">mdot_air_PZ_i</span>   <span class="o">=</span> <span class="n">f_PSR_PZ_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">mdot_air_PZ</span> <span class="o">+</span> <span class="n">mdot_fuel</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">phi_PSR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">stoichiometric_fuel_air_ratio</span><span class="p">)</span> <span class="c1"># [kg/s] Air mass flow rate in the PSR</span>
            <span class="n">mdot_fuel_PZ_i</span>  <span class="o">=</span> <span class="n">mdot_air_PZ_i</span> <span class="o">*</span> <span class="n">phi_PSR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">stoichiometric_fuel_air_ratio</span> <span class="c1"># [kg/s] Fuel mass flow rate in the PSR</span>
            <span class="n">mdot_total_PZ_i</span> <span class="o">=</span> <span class="n">mdot_air_PZ_i</span> <span class="o">+</span> <span class="n">mdot_fuel_PZ_i</span>               <span class="c1"># [kg/s] Total mass flow rate in the PSR</span>
            <span class="n">mdot_PZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdot_total_PZ_i</span><span class="p">)</span>                                <span class="c1"># [-] Store total mass flow rate in the PSR</span>

            <span class="n">h_mix_PZ_i</span>      <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">mdot_air_PZ_i</span> <span class="o">+</span> <span class="n">mdot_fuel_PZ_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">mdot_air_PZ_i</span> <span class="o">*</span> <span class="n">air</span><span class="o">.</span><span class="n">h</span> <span class="o">+</span> <span class="n">mdot_fuel_PZ_i</span> <span class="o">*</span> <span class="n">fuel_hot</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="n">mdot_fuel_PZ_i</span> <span class="o">*</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">heat_of_vaporization</span> <span class="o">+</span> <span class="n">delta_h</span><span class="p">))</span> <span class="c1"># [J/kg] Mixture specific enthalpy</span>
            <span class="n">psr_gas_PZ_i</span>    <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>                             <span class="c1"># [-] PSR gas object</span>
            <span class="n">psr_gas_PZ_i</span><span class="o">.</span><span class="n">set_equivalence_ratio</span><span class="p">(</span><span class="n">phi_PSR</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">fuel_surrogate_S1</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">air_data</span><span class="o">.</span><span class="n">air_surrogate</span><span class="p">)</span>  <span class="c1"># [-] Set equivalence ratio, fuel, and air mole fractions</span>
            <span class="n">psr_gas_PZ_i</span><span class="o">.</span><span class="n">HP</span> <span class="o">=</span> <span class="n">h_mix_PZ_i</span><span class="p">,</span> <span class="n">Pres_air</span>                         <span class="c1"># [J/kg, Pa] Set enthalpy and pressure</span>
            <span class="n">psr_gas_PZ_i</span><span class="o">.</span><span class="n">equilibrate</span><span class="p">(</span><span class="s1">&#39;HP&#39;</span><span class="p">)</span>                                 <span class="c1"># [-] Equilibrate the gas at constant enthalpy and pressure</span>
            
            <span class="n">psr_PZ_i</span>        <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">psr_gas_PZ_i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># [-] PSR object</span>
            <span class="n">psr_PZ_i</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">V_PZ_PSR</span>                                     <span class="c1"># [m^3] PSR volume</span>
            <span class="n">PZ_Structures</span><span class="p">[</span><span class="s2">&quot;PSRs&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;PSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psr_PZ_i</span>                 <span class="c1"># [-] Store PSR object</span>

            <span class="n">mfc_air_PZ_i</span>       <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">MassFlowController</span><span class="p">(</span><span class="n">air_reservoir</span><span class="p">,</span> <span class="n">psr_PZ_i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AirToPSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot_air_PZ_i</span><span class="p">)</span> <span class="c1"># [-] Air mass flow controller</span>
            <span class="n">PZ_Structures</span><span class="p">[</span><span class="s2">&quot;MFC_AirToPSR&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;AirToPSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfc_air_PZ_i</span> <span class="c1"># [-] Store air mass flow controller</span>
            <span class="n">mfc_fuel_PZ_i</span>      <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">MassFlowController</span><span class="p">(</span><span class="n">fuel_reservoir</span><span class="p">,</span> <span class="n">psr_PZ_i</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;FuelToPSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mdot</span><span class="o">=</span><span class="n">mdot_fuel_PZ_i</span><span class="p">)</span> <span class="c1"># [-] Fuel mass flow controller</span>
            <span class="n">PZ_Structures</span><span class="p">[</span><span class="s2">&quot;MFC_FuelToPSR&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;FuelToPSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfc_fuel_PZ_i</span> <span class="c1"># [-] Store fuel mass flow controller</span>

            <span class="n">psr_network_PZ_i</span>   <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">psr_PZ_i</span><span class="p">])</span>                 <span class="c1"># [-] PSR network setup</span>
            <span class="n">rho_PZ_i</span>           <span class="o">=</span> <span class="n">psr_gas_PZ_i</span><span class="o">.</span><span class="n">density</span>                      <span class="c1"># [kg/m^3] Gas density in the PSR</span>
            <span class="n">t_res_PZ_i</span>         <span class="o">=</span> <span class="n">V_PZ_PSR</span> <span class="o">*</span> <span class="n">rho_PZ_i</span> <span class="o">/</span> <span class="n">mdot_total_PZ_i</span>     <span class="c1"># [s] Residence time in the PSR</span>
            <span class="n">mass_psr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_res_PZ_i</span> <span class="o">*</span> <span class="n">mdot_total_PZ_i</span><span class="p">)</span>             <span class="c1"># [-] Mass of PSR</span>
            <span class="n">psr_network_PZ_i</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">t_res_PZ_i</span><span class="p">)</span>                           <span class="c1"># [-] Advance the PSR network</span>

            <span class="n">mfc_out_PZ_i</span>       <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">MassFlowController</span><span class="p">(</span><span class="n">psr_PZ_i</span><span class="p">,</span> <span class="n">mixer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;PSRToMixer_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mdot</span> <span class="o">=</span> <span class="n">mdot_total_PZ_i</span><span class="p">)</span> <span class="c1"># [-] PSR to mixer mass flow controller</span>
            <span class="n">PZ_Structures</span><span class="p">[</span><span class="s2">&quot;MFC_PSRToMixer&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;PSRToMixer_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfc_out_PZ_i</span> <span class="c1"># [-] Store PSR to mixer mass flow controller</span>
            
            <span class="n">EI</span> <span class="o">=</span> <span class="n">calculate_emission_indices</span><span class="p">(</span><span class="n">psr_PZ_i</span><span class="p">,</span> <span class="n">mdot_total_PZ_i</span><span class="p">,</span> <span class="n">mdot_fuel_PZ_i</span><span class="p">)</span> <span class="c1"># [-] Emission indices computation</span>

            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phi_PSR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>                 <span class="c1"># [-] Store Equivalence ratio</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psr_gas_PZ_i</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>               <span class="c1"># [K] Store Temperature</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">f_psr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_PSR_PZ_i</span><span class="p">)</span>               <span class="c1"># [-] Store mass flow rate fraction</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">])</span>            <span class="c1"># [kg/kg_fuel] Store NOx emission index</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">])</span>            <span class="c1"># [kg/kg_fuel] Store CO2 emission index</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">])</span>              <span class="c1"># [kg/kg_fuel] Store CO emission index</span>
            <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">psr</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">])</span>            <span class="c1"># [kg/kg_fuel] Store H2O emission index\</span>

        <span class="c1"># ----------------------------------------------------------------------</span>
        <span class="c1">#  Initial Mixing</span>
        <span class="c1"># ----------------------------------------------------------------------</span>
        
        <span class="n">mdot_tot_PZ</span>       <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mdot_PZ</span><span class="p">)</span>                                   <span class="c1"># [kg/s] Total mass flow rate of the PZ</span>
        <span class="n">mixture_list</span>      <span class="o">=</span> <span class="p">[]</span>                                             <span class="c1"># [-] Mixture list</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">N_PZ</span><span class="p">):</span>
            <span class="n">psr_output</span>    <span class="o">=</span> <span class="n">PZ_Structures</span><span class="p">[</span><span class="s2">&quot;PSRs&quot;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;PSR_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">thermo</span>     <span class="c1"># [-] PSR output</span>
            <span class="n">mixture</span>       <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">psr_output</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="s1">&#39;HP&#39;</span><span class="p">)</span>         <span class="c1"># [-] Mixture Quantity setup</span>
            <span class="n">mixture</span><span class="o">.</span><span class="n">TPX</span>   <span class="o">=</span> <span class="n">psr_output</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">psr_output</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">psr_output</span><span class="o">.</span><span class="n">X</span>       <span class="c1"># [K, Pa, -] Temperauture, Pressure and Mole fraction composition of the ixture</span>
            <span class="n">mixture</span><span class="o">.</span><span class="n">moles</span> <span class="o">=</span> <span class="n">mass_psr_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">psr_output</span><span class="o">.</span><span class="n">mean_molecular_weight</span> <span class="c1"># [-] Mixture moles</span>
            <span class="n">mixture_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixture</span><span class="p">)</span>                                   <span class="c1"># [-] Store mixture moles</span>
        <span class="n">mixture_sum</span>       <span class="o">=</span> <span class="n">mixture_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                                <span class="c1"># [-] Define Mixture sum</span>
        
        <span class="k">for</span> <span class="n">mixture</span> <span class="ow">in</span> <span class="n">mixture_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> 
            <span class="n">mixture_sum</span>  <span class="o">+=</span> <span class="n">mixture</span>                                        <span class="c1"># [-] Add all into a Mixture sum</span>
    
        <span class="n">EI_mixer_initial</span> <span class="o">=</span> <span class="n">calculate_emission_indices</span><span class="p">(</span><span class="n">mixture_sum</span><span class="p">,</span> <span class="n">mdot_tot_PZ</span><span class="p">,</span> <span class="n">mdot_fuel</span><span class="p">)</span> <span class="c1"># [-] Emission indices computation</span>

        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">equivalence_ratio</span><span class="p">()</span>    <span class="c1"># [-] Store Equivalence ratio</span>
        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">T</span>                        <span class="c1"># [K] Store Temperature</span>
        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span> <span class="o">=</span> <span class="n">EI_mixer_initial</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">]</span>      <span class="c1"># [kg/kg_fuel] Store NOx emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span> <span class="o">=</span> <span class="n">EI_mixer_initial</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">]</span>      <span class="c1"># [kg/kg_fuel] Store CO2 emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span> <span class="o">=</span> <span class="n">EI_mixer_initial</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">]</span>        <span class="c1"># [kg/kg_fuel] Store CO emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">PZ</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span> <span class="o">=</span> <span class="n">EI_mixer_initial</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">]</span>      <span class="c1"># [kg/kg_fuel] Store H2O emission index</span>

        <span class="c1"># ----------------------------------------------------------------------</span>
        <span class="c1">#  Secondary Zone</span>
        <span class="c1"># ----------------------------------------------------------------------</span>

        <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span>                      <span class="o">=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_PZ</span> <span class="c1"># [m] Secondary Zone length</span>
        <span class="n">A_SZ</span>                                <span class="o">=</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">volume</span><span class="o">/</span><span class="n">combustor</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>  <span class="c1"># [m^2] Cross-sectional area of Secondary Zone</span>
        <span class="n">f_air_SA</span>                            <span class="o">=</span> <span class="n">mdot_fuel_TakeOff</span> <span class="o">/</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">design_equivalence_ratio_SZ</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">fuel_data</span><span class="o">.</span><span class="n">stoichiometric_fuel_air_ratio</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">air_mass_flow_rate_take_off</span><span class="p">)</span> <span class="c1"># [-] Secondary air mass flow fraction</span>
        <span class="n">f_air_DA</span>                            <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">f_air_PZ</span> <span class="o">-</span> <span class="n">f_air_SA</span>      <span class="c1"># [-] Dilution air mass flow fraction</span>
        <span class="n">f_FM</span>                                <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">combustor</span><span class="o">.</span><span class="n">f_SM</span>           <span class="c1"># [-] Fast mode fraction</span>
        <span class="n">beta_SA_FM</span>                          <span class="o">=</span> <span class="p">(</span><span class="n">f_air_SA</span> <span class="o">*</span> <span class="n">f_FM</span> <span class="o">*</span> <span class="n">mdot_air</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">l_SA_FM</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span><span class="p">)</span> <span class="c1"># [kg/s/m] Secondary air mass flow rate per unit length in fast mode</span>
        <span class="n">beta_SA_SM</span>                          <span class="o">=</span> <span class="p">(</span><span class="n">f_air_SA</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">f_SM</span> <span class="o">*</span> <span class="n">mdot_air</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">l_SA_SM</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span><span class="p">)</span> <span class="c1"># [kg/s/m] Secondary air mass flow rate per unit length in slow mode</span>
        <span class="n">beta_DA</span>                             <span class="o">=</span> <span class="p">(</span><span class="n">f_air_DA</span> <span class="o">*</span> <span class="n">mdot_air</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_end</span> <span class="o">-</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span><span class="p">)</span> <span class="c1"># [kg/s/m] Dilution air mass flow rate per unit length</span>
        <span class="n">mdot_total_sm</span>                       <span class="o">=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">f_SM</span> <span class="o">*</span> <span class="n">mdot_tot_PZ</span> <span class="c1"># [kg/s] Initial total mass flow rate in slow mode</span>
        <span class="n">mdot_total_fm</span>                       <span class="o">=</span> <span class="n">f_FM</span> <span class="o">*</span> <span class="n">mdot_tot_PZ</span>           <span class="c1"># [kg/s] Initial total mass flow rate in fast mode</span>
        <span class="n">dz</span>                                  <span class="o">=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_SZ</span> <span class="c1"># [m] Discretization step size</span>
        <span class="n">z_positions</span>                         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_SZ</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># [m] Axial position array</span>

        <span class="c1"># Slow Mode </span>
        <span class="n">mixed_gas_sm</span>                        <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>             <span class="c1"># [-] Slow mode gas object</span>
        <span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">TPX</span>                    <span class="o">=</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">X</span> <span class="c1"># [K, Pa, -] Initial state from PZ mixture</span>
        <span class="n">reactor_sm</span>                          <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="p">)</span> <span class="c1"># [-] Slow mode reactor</span>
        <span class="n">sim_sm</span>                              <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_sm</span><span class="p">])</span>  <span class="c1"># [-] Slow mode reactor network</span>

        <span class="k">for</span> <span class="n">z_sm</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">joint_mixing_fraction</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_SZ</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">z_frac_sm</span>                       <span class="o">=</span> <span class="n">z_sm</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span>        <span class="c1"># [-] Fractional position in SZ</span>
            <span class="n">mdot_air_added_sm</span>               <span class="o">=</span> <span class="p">(</span><span class="n">beta_SA_SM</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">z_frac_sm</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_SA_SM</span> <span class="k">else</span>
                                            <span class="n">beta_DA</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_start</span> <span class="o">&lt;=</span> <span class="n">z_frac_sm</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_end</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1"># [kg/s] Air mass flow rate added</span>
            <span class="n">previous_mdot_total_sm</span>          <span class="o">=</span> <span class="n">mdot_total_sm</span>                <span class="c1"># [kg/s] Previous total mass flow rate</span>
            <span class="n">mdot_total_sm</span>                  <span class="o">+=</span> <span class="n">mdot_air_added_sm</span>            <span class="c1"># [kg/s] Update total mass flow rate</span>
            <span class="n">residence_time</span>                  <span class="o">=</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">A_SZ</span> <span class="o">*</span> <span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">density</span> <span class="o">/</span> <span class="n">mdot_total_sm</span> <span class="c1"># [s] Residence time</span>

            <span class="n">air_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">air</span><span class="p">)</span>             <span class="c1"># [-] Air quantity object</span>
            <span class="n">air_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">mdot_air_added_sm</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of air added over residence time</span>
            <span class="n">mix_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="p">)</span>    <span class="c1"># [-] Mixture quantity object</span>
            <span class="n">mix_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">previous_mdot_total_sm</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of existing mixture over residence time</span>
            <span class="n">mixture_sm</span>                      <span class="o">=</span> <span class="n">mix_qty</span> <span class="o">+</span> <span class="n">air_qty</span>            <span class="c1"># [-] Combined mixture</span>

            <span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">TP</span>                 <span class="o">=</span> <span class="n">mixture_sm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mixture_sm</span><span class="o">.</span><span class="n">P</span>   <span class="c1"># [K, Pa] Update temperature and pressure</span>
            <span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">Y</span>                  <span class="o">=</span> <span class="n">mixture_sm</span><span class="o">.</span><span class="n">Y</span>                 <span class="c1"># [-] Update composition</span>

            <span class="n">reactor_sm</span>                      <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="p">)</span> <span class="c1"># [-] Slow mode reactor</span>
            <span class="n">sim_sm</span>                          <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_sm</span><span class="p">])</span>  <span class="c1"># [-] Reactor setup</span>
            <span class="n">sim_sm</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">residence_time</span><span class="p">)</span>                                 <span class="c1"># [-] Advance simulation</span>

            <span class="n">EI_sm</span>                           <span class="o">=</span> <span class="n">calculate_emission_indices</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="p">,</span> <span class="n">mdot_total_sm</span><span class="p">,</span> <span class="n">combustor</span><span class="o">.</span><span class="n">f_SM</span> <span class="o">*</span> <span class="n">mdot_fuel</span><span class="p">)</span> <span class="c1"># [-] Emission indices    </span>

            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">equivalence_ratio</span><span class="p">())</span> <span class="c1"># [-] Store equivalence ratio</span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>                <span class="c1"># [K] Store temperature </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_frac_sm</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>               <span class="c1"># [%] Store position percentage </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_sm</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store CO2 emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_sm</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store NOx emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_sm</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">])</span>            <span class="c1"># [kg/kg_fuel] Store CO emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_sm</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store H2O emission index</span>

        <span class="c1"># Fast Mode</span>
        <span class="n">mixed_gas_fm</span>                        <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>             <span class="c1"># [-] Fast mode gas object</span>
        <span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">TPX</span>                    <span class="o">=</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">mixture_sum</span><span class="o">.</span><span class="n">X</span> <span class="c1"># [K, Pa, -] Initial state from PZ mixture</span>
        <span class="n">reactor_fm</span>                          <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="p">)</span> <span class="c1"># [-] Fast mode reactor</span>
        <span class="n">sim_fm</span>                              <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_fm</span><span class="p">])</span>  <span class="c1"># [-] Fast mode reactor network</span>

        <span class="k">for</span> <span class="n">z_fm</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">joint_mixing_fraction</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_SZ</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">z_frac_fm</span>                       <span class="o">=</span> <span class="n">z_fm</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span>        <span class="c1"># [-] Fractional position in SZ</span>
            <span class="n">mdot_air_added_fm</span>               <span class="o">=</span> <span class="p">(</span><span class="n">beta_SA_FM</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">z_frac_fm</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_SA_FM</span> <span class="k">else</span>
                                            <span class="n">beta_DA</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_start</span> <span class="o">&lt;=</span> <span class="n">z_frac_fm</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_end</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1"># [kg/s] Air mass flow rate added</span>
            <span class="n">previous_mdot_total_fm</span>          <span class="o">=</span> <span class="n">mdot_total_fm</span>                <span class="c1"># [kg/s] Previous total mass flow rate</span>
            <span class="n">mdot_total_fm</span>                  <span class="o">+=</span> <span class="n">mdot_air_added_fm</span>            <span class="c1"># [kg/s] Update total mass flow rate</span>
            <span class="n">residence_time</span>                  <span class="o">=</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">A_SZ</span> <span class="o">*</span> <span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">density</span> <span class="o">/</span> <span class="n">mdot_total_fm</span> <span class="c1"># [s] Residence time</span>

            <span class="n">air_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">air</span><span class="p">)</span>             <span class="c1"># [-] Air quantity object</span>
            <span class="n">air_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">mdot_air_added_fm</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of air added over residence time</span>
            <span class="n">mix_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="p">)</span>    <span class="c1"># [-] Mixture quantity object</span>
            <span class="n">mix_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">previous_mdot_total_fm</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of existing mixture over residence time</span>
            <span class="n">mixture_fm</span>                      <span class="o">=</span> <span class="n">mix_qty</span> <span class="o">+</span> <span class="n">air_qty</span>            <span class="c1"># [-] Combined mixture</span>

            <span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">TP</span>                 <span class="o">=</span> <span class="n">mixture_fm</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mixture_fm</span><span class="o">.</span><span class="n">P</span>   <span class="c1"># [K, Pa] Update temperature and pressure</span>
            <span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">Y</span>                  <span class="o">=</span> <span class="n">mixture_fm</span><span class="o">.</span><span class="n">Y</span>                 <span class="c1"># [-] Update composition</span>

            <span class="n">reactor_fm</span>                      <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="p">)</span> <span class="c1"># [-] Slow mode reactor</span>
            <span class="n">sim_fm</span>                          <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_fm</span><span class="p">])</span>  <span class="c1"># [-] Reactor setup</span>
            <span class="n">sim_fm</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">residence_time</span><span class="p">)</span>                                 <span class="c1"># [-] Advance simulation</span>

            <span class="n">EI_fm</span>                           <span class="o">=</span> <span class="n">calculate_emission_indices</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="p">,</span> <span class="n">mdot_total_fm</span><span class="p">,</span> <span class="n">f_FM</span> <span class="o">*</span> <span class="n">mdot_fuel</span><span class="p">)</span> <span class="c1"># [-] Emission indices</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">equivalence_ratio</span><span class="p">())</span> <span class="c1"># [-] Store equivalence ratio</span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>                <span class="c1"># [K] Store temperature </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_frac_fm</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>               <span class="c1"># [%] Store position percentage </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_fm</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store CO2 emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_fm</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store NOx emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_fm</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">])</span>            <span class="c1"># [kg/kg_fuel] Store CO emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">fm</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_fm</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">])</span>          <span class="c1"># [kg/kg_fuel] Store H2O emission index</span>

        <span class="c1"># Joint Mixing </span>
        <span class="n">mixed_gas_joint</span>                     <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Solution</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>             <span class="c1"># [-] Joint mode gas object</span>
        <span class="n">total_mass_flow</span>                     <span class="o">=</span> <span class="n">mdot_total_sm</span> <span class="o">+</span> <span class="n">mdot_total_fm</span> <span class="c1"># [kg/s] Total mass flow rate after slow and fast modes</span>
        <span class="n">sm_qty</span>                              <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mixed_gas_sm</span><span class="p">)</span>    <span class="c1"># [-] Slow mode quantity</span>
        <span class="n">fm_qty</span>                              <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mixed_gas_fm</span><span class="p">)</span>    <span class="c1"># [-] Fast mode quantity</span>
        <span class="n">joint_mixture</span>                       <span class="o">=</span> <span class="n">sm_qty</span> <span class="o">+</span> <span class="n">fm_qty</span>              <span class="c1"># [-] Combined mixture</span>
        <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">TP</span>                  <span class="o">=</span> <span class="n">joint_mixture</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">joint_mixture</span><span class="o">.</span><span class="n">P</span> <span class="c1"># [K, Pa] Initial temperature and pressure</span>
        <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">Y</span>                   <span class="o">=</span> <span class="n">joint_mixture</span><span class="o">.</span><span class="n">Y</span>              <span class="c1"># [-] Initial composition</span>
        <span class="n">mdot_total_joint</span>                    <span class="o">=</span> <span class="n">total_mass_flow</span>              <span class="c1"># [kg/s] Initial total mass flow rate</span>
        <span class="n">reactor_joint</span>                       <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="p">)</span> <span class="c1"># [-] Joint mode reactor</span>
        <span class="n">sim_joint</span>                           <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_joint</span><span class="p">])</span> <span class="c1"># [-] Joint mode reactor network</span>

        <span class="k">for</span> <span class="n">z_joint</span> <span class="ow">in</span> <span class="n">z_positions</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">combustor</span><span class="o">.</span><span class="n">joint_mixing_fraction</span> <span class="o">*</span> <span class="n">combustor</span><span class="o">.</span><span class="n">N_SZ</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
            <span class="n">z_frac_joint</span>                    <span class="o">=</span> <span class="n">z_joint</span> <span class="o">/</span> <span class="n">combustor</span><span class="o">.</span><span class="n">L_SZ</span>     <span class="c1"># [-] Fractional position in SZ</span>
            <span class="n">mdot_air_added_joint</span>            <span class="o">=</span> <span class="p">(</span><span class="n">beta_SA_FM</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">z_frac_joint</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_SA_FM</span> <span class="k">else</span>
                                            <span class="n">beta_DA</span> <span class="o">*</span> <span class="n">dz</span> <span class="k">if</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_start</span> <span class="o">&lt;=</span> <span class="n">z_frac_joint</span> <span class="o">&lt;=</span> <span class="n">combustor</span><span class="o">.</span><span class="n">l_DA_end</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1"># [kg/s] Air mass flow rate added</span>
            <span class="n">previous_mdot_total_joint</span>       <span class="o">=</span> <span class="n">mdot_total_joint</span>             <span class="c1"># [kg/s] Previous total mass flow rate</span>
            <span class="n">mdot_total_joint</span>               <span class="o">+=</span> <span class="n">mdot_air_added_joint</span>         <span class="c1"># [kg/s] Update total mass flow rate</span>
            <span class="n">residence_time</span>                  <span class="o">=</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">A_SZ</span> <span class="o">*</span> <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">density</span> <span class="o">/</span> <span class="n">mdot_total_joint</span> <span class="c1"># [s] Residence time</span>

            <span class="n">air_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">air</span><span class="p">)</span>             <span class="c1"># [-] Air quantity object</span>
            <span class="n">air_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">mdot_air_added_joint</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of air added over residence time</span>
            <span class="n">mix_qty</span>                         <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="p">)</span> <span class="c1"># [-] Mixture quantity object</span>
            <span class="n">mix_qty</span><span class="o">.</span><span class="n">mass</span>                    <span class="o">=</span> <span class="n">previous_mdot_total_joint</span> <span class="o">*</span> <span class="n">residence_time</span> <span class="c1"># [kg] Mass of existing mixture over residence time</span>
            <span class="n">mixture_joint</span>                   <span class="o">=</span> <span class="n">mix_qty</span> <span class="o">+</span> <span class="n">air_qty</span>            <span class="c1"># [-] Combined mixture</span>

            <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">TP</span>              <span class="o">=</span> <span class="n">mixture_joint</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mixture_joint</span><span class="o">.</span><span class="n">P</span> <span class="c1"># [K, Pa] Update temperature and pressure</span>
            <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">Y</span>               <span class="o">=</span> <span class="n">mixture_joint</span><span class="o">.</span><span class="n">Y</span>              <span class="c1"># [-] Update composition</span>

            <span class="n">reactor_joint</span>                   <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ConstPressureReactor</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="p">)</span> <span class="c1"># [-] Joint mode reactor</span>
            <span class="n">sim_joint</span>                       <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ReactorNet</span><span class="p">([</span><span class="n">reactor_joint</span><span class="p">])</span> <span class="c1"># [-] Reactor setup</span>
            <span class="n">sim_joint</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">residence_time</span><span class="p">)</span>                              <span class="c1"># [-] Advance simulation</span>

            <span class="n">EI_joint</span>                        <span class="o">=</span> <span class="n">calculate_emission_indices</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="p">,</span> <span class="n">mdot_total_joint</span><span class="p">,</span> <span class="n">mdot_fuel</span><span class="p">)</span> <span class="c1"># [-] Emission indices</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">equivalence_ratio</span><span class="p">())</span> <span class="c1"># [-] Store equivalence ratio</span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>          <span class="c1"># [K] Store temperature </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_frac_joint</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>         <span class="c1"># [%] Store position percentage </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">])</span>    <span class="c1"># [kg/kg_fuel] Store CO2 emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">])</span>    <span class="c1"># [kg/kg_fuel] Store NOx emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">])</span>      <span class="c1"># [kg/kg_fuel] Store CO emission index </span>
            <span class="n">results</span><span class="o">.</span><span class="n">SZ</span><span class="o">.</span><span class="n">joint</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">])</span>    <span class="c1"># [kg/kg_fuel] Store H2O emission index</span>

        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">equivalence_ratio</span><span class="p">()</span> <span class="c1"># [-] Store Equivalence ratio</span>
        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">mixed_gas_joint</span><span class="o">.</span><span class="n">T</span>                    <span class="c1"># [K] Store Temperature</span>
        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">NOx</span> <span class="o">=</span> <span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;NOx&#39;</span><span class="p">]</span>              <span class="c1"># [kg/kg_fuel] Store NOx emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO2</span> <span class="o">=</span> <span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">]</span>              <span class="c1"># [kg/kg_fuel] Store CO2 emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">CO</span> <span class="o">=</span> <span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;CO&#39;</span><span class="p">]</span>                <span class="c1"># [kg/kg_fuel] Store CO emission index</span>
        <span class="n">results</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">EI</span><span class="o">.</span><span class="n">H2O</span> <span class="o">=</span> <span class="n">EI_joint</span><span class="p">[</span><span class="s1">&#39;H2O&#39;</span><span class="p">]</span>              <span class="c1"># [kg/kg_fuel] Store H2O emission index</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="calculate_emission_indices">
<a class="viewcode-back" href="../../../../../../_autosummary/RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.html#RCAIDE.Library.Methods.Emissions.Chemical_Reactor_Network_Method.evaluate_cantera.calculate_emission_indices">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_emission_indices</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span>  <span class="n">mdot_total</span><span class="p">,</span> <span class="n">mdot_fuel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate emission indices for combustion products&quot;&quot;&quot;</span>
    <span class="n">gas</span>                                 <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">thermo</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s1">&#39;thermo&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">reactor</span> <span class="c1"># [-] Extract gas object</span>
    <span class="n">NOx_species</span>                         <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span> <span class="s1">&#39;NO2&#39;</span><span class="p">]</span>              <span class="c1"># [-] List of NOx species</span>
    <span class="n">EI_NOx</span>                              <span class="o">=</span> <span class="mf">0.0</span>                        <span class="c1"># [kg/kg_fuel] Initialize NOx emission index</span>
    <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">NOx_species</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx</span>                         <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">species_index</span><span class="p">(</span><span class="n">species</span><span class="p">)</span> <span class="c1"># [-] Species index</span>
            <span class="n">EI_NOx</span>                     <span class="o">+=</span> <span class="n">gas</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">mdot_total</span> <span class="o">/</span> <span class="n">mdot_fuel</span> <span class="c1"># [kg/kg_fuel] Add contribution to NOx EI</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="n">EI</span>                                  <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CO2&#39;</span><span class="p">:</span> <span class="n">gas</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">gas</span><span class="o">.</span><span class="n">species_index</span><span class="p">(</span><span class="s1">&#39;CO2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">mdot_total</span> <span class="o">/</span> <span class="n">mdot_fuel</span><span class="p">,</span> <span class="c1"># [kg/kg_fuel] CO2 emission index</span>
        <span class="s1">&#39;CO&#39;</span><span class="p">:</span> <span class="n">gas</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">gas</span><span class="o">.</span><span class="n">species_index</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">mdot_total</span> <span class="o">/</span> <span class="n">mdot_fuel</span><span class="p">,</span>   <span class="c1"># [kg/kg_fuel] CO emission index</span>
        <span class="s1">&#39;H2O&#39;</span><span class="p">:</span> <span class="n">gas</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">gas</span><span class="o">.</span><span class="n">species_index</span><span class="p">(</span><span class="s1">&#39;H2O&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">mdot_total</span> <span class="o">/</span> <span class="n">mdot_fuel</span><span class="p">,</span> <span class="c1"># [kg/kg_fuel] H2O emission index</span>
        <span class="s1">&#39;NOx&#39;</span><span class="p">:</span> <span class="n">EI_NOx</span><span class="p">,</span>                                                   <span class="c1"># [kg/kg_fuel] NOx emission index</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">EI</span>                                                            <span class="c1"># [-] Return emission indices dictionary</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2024, Laboratory for Electric Aircraft Design and Sustainability.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>